<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> iOS学习笔记-hmap文件 · nakahira's Blog</title><meta name="description" content="iOS学习笔记-hmap文件 - John Doe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="nakahira's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">HOME</a></li><li class="nav-list-item"><a href="/archives" target="_self" class="nav-list-link">ARCHIVES</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">iOS学习笔记-hmap文件</h1><div class="post-info">2020年8月23日</div><div class="post-content"><blockquote>
<p>本文乃个人学习时的想法记录，内容难免会有所勘误，如阁下有所发现，期待指正。</p>
</blockquote>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>在初学编程，且未用广大IDE时，我所见到的很多教程都是以一个简单的文本编辑器作为工具，然后使用gcc编译器进行运行，类似于:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc main.c</span><br></pre></td></tr></table></figure>
<p>而在后面源文件变得不止一个后，我们就开始学习使用如<code>-iquote</code>或<code>-I</code>参数来指定头文件的搜索路径……</p>
<h2 id="Xcode中的头文件搜索"><a href="#Xcode中的头文件搜索" class="headerlink" title="Xcode中的头文件搜索"></a>Xcode中的头文件搜索</h2><p>在Xcode中对于头文件的引用，分为<code>&quot;&quot;</code>和<code>&lt;&gt;</code>两种方式(暂时就这么说)，其搜索顺序为:</p>
<ul>
<li><p>import “A.h” </p>
<ol>
<li><p>相同路径下是否存在<code>A.h</code></p>
</li>
<li><p>根据是否开启<code>Use Header Maps</code>决定是否使用其内部的映射路径</p>
</li>
<li>参数<code>-iquote</code>(Xcode中的User Header Search Paths)指向的路径下</li>
<li>参数<code>-I</code>(Xcode中Header Search Paths)指向的路径下</li>
<li>参数<code>-isystem</code>(Xcode中System Header Search Paths)指向的路径下</li>
<li>系统SDK(<code>-isysroot</code>参数指定)目录下</li>
</ol>
</li>
<li><p>import <a.h> </a.h></p>
<ol>
<li>根据是否开启<code>Use Header Maps</code>决定是否使用其内部的映射路径</li>
<li>参数<code>-I</code>(Xcode中Header Search Paths)指向的路径下</li>
<li>参数<code>-isystem</code>(Xcode中System Header Search Paths)指向的路径下</li>
<li>系统SDK(<code>-isysroot</code>参数指定)目录下</li>
</ol>
</li>
</ul>
<p>其第一步的hmap(Header Maps)文件，就是今天的主题。</p>
<h2 id="Header-Maps"><a href="#Header-Maps" class="headerlink" title="Header Maps"></a>Header Maps</h2><h3 id="个人想法"><a href="#个人想法" class="headerlink" title="个人想法"></a>个人想法</h3><p>众所周知我们在Xcode项目中创建一个文件时，在另一个文件就可以指定import””过去，而不需要指定其比较完整的路径，根据上面列出的搜索搜索顺序，我们先排除第一个hmap选项(实际上就是它，但是暂时忽略，看看如果没有它的情况该怎么查找)。那不用想，肯定是用第二个-iquote来传递搜索路径，当我们真的使用其作为工程文件内的头文件搜索方式时，我们会发现，为了能够查找到当前项目下所有的头文件，就必须打开路径的<code>recursive</code>功能，使其可以递归的包含所有子路径，其效率势必要收到影响，尤其是遇到比较大的项目时；当然也可以在每次新增文件时，让Xcode能够自动管理-iquote需要使用的所有参数，当然的确是可行的，但是！但是！我特么既然都需要根据项目文件自动管理-iquote的所有参数了，为啥不直接免了即使使用<code>-iquote</code>也需要的查找过程？直接给每个filename自动管理其实际路径不就好了？那么，这就是前面所说的hmap文件所完成的功能。</p>
<h3 id="hmap文件介绍"><a href="#hmap文件介绍" class="headerlink" title="hmap文件介绍"></a>hmap文件介绍</h3><p>hmap文件实际是Xcode编译过程中的众多临时文件中的一种，其主要是用来映射头文件名和路径，我们可以大概看下它长什么样。对了，为了加快索引性能，hmap文件本身是被序列化的二进制文件，所以我们需要用一些小工具来看它:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hmap print /Users/nakahira/Library/Developer/Xcode/DerivedData/hmap-hook-hbsayybhznfanuhhjxhpnqvompoq/Build/Intermediates.noindex/hmap-hook.build/Debug-iphonesimulator/hmap-hook.build/hmap-hook-project-headers.hmap</span></span><br><span class="line">AppDelegate.h -&gt; /Users/nakahira/Desktop/Dev/myGithub/llvm-study/hmap-hook/hmap-hook/AppDelegate.h</span><br><span class="line">SceneDelegate.h -&gt; /Users/nakahira/Desktop/Dev/myGithub/llvm-study/hmap-hook/hmap-hook/SceneDelegate.h</span><br><span class="line">ViewController.h -&gt; /Users/nakahira/Desktop/Dev/myGithub/llvm-study/hmap-hook/hmap-hook/ViewController.h</span><br></pre></td></tr></table></figure>
<p>如上所示，就是hmap文件的内容，个人觉得最大的用处在于管理当前项目下的头文件，而那些库文件大部分情况下都是由后面的几种方式来查找。</p>
<p>对于一个文件在编译过程中使用了哪些hmap文件，我们可以通过复制Xcode中的编译过程中你想看的文件的编译命令加上<code>-v</code>执行，输出如下所示:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ...已省略无关输出</span></span><br><span class="line"><span class="comment">#include "..." search starts here:</span></span><br><span class="line"> /Users/junghsu/Library/Developer/Xcode/DerivedData/hmap-hook-cwxupfhdjgswmncjxxagwtagpury/Build/Intermediates.noindex/Pods.build/Debug-iphonesimulator/SDWebImage.build/SDWebImage-generated-files.hmap (headermap)</span><br><span class="line"> /Users/junghsu/Library/Developer/Xcode/DerivedData/hmap-hook-cwxupfhdjgswmncjxxagwtagpury/Build/Intermediates.noindex/Pods.build/Debug-iphonesimulator/SDWebImage.build/SDWebImage-project-headers.hmap (headermap)</span><br><span class="line"><span class="comment">#include &lt;...&gt; search starts here:</span></span><br><span class="line"> /Users/junghsu/Library/Developer/Xcode/DerivedData/hmap-hook-cwxupfhdjgswmncjxxagwtagpury/Build/Intermediates.noindex/Pods.build/Debug-iphonesimulator/SDWebImage.build/SDWebImage-own-target-headers.hmap (headermap)</span><br><span class="line"> /Users/junghsu/Library/Developer/Xcode/DerivedData/hmap-hook-cwxupfhdjgswmncjxxagwtagpury/Build/Intermediates.noindex/Pods.build/Debug-iphonesimulator/SDWebImage.build/SDWebImage-all-non-framework-target-headers.hmap (headermap)</span><br><span class="line"> /Users/junghsu/Library/Developer/Xcode/DerivedData/hmap-hook-cwxupfhdjgswmncjxxagwtagpury/Build/Intermediates.noindex/Pods.build/Debug-iphonesimulator/SDWebImage.build/DerivedSources</span><br><span class="line"> /Users/junghsu/Library/Developer/Xcode/DerivedData/hmap-hook-cwxupfhdjgswmncjxxagwtagpury/Build/Products/Debug-iphonesimulator/SDWebImage (framework directory)</span><br><span class="line"> /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/clang/11.0.3/include</span><br><span class="line"> /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator13.5.sdk/usr/include</span><br><span class="line"> /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include</span><br><span class="line"> /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator13.5.sdk/System/Library/Frameworks (framewo</span><br></pre></td></tr></table></figure>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>在某次比较凑巧的情况下，本人遇到了一个有关于这个的实际问题场景：</p>
<p>我们的项目中引入了腾讯云的<code>QCloudCOSXML</code>这个库，而由此我为了加快工程文件的索引速度，准备开启Cocoapods的Pod改为单独工程的设置，可是在编译时却遇到了<code>QCloudCOSXML</code>这个库内的头文件导入报错问题，定睛一看，这个库内某些文件对于它自己另一个库(实际上是另一个Pod)的头文件的引入方式为<code>import &quot;&quot;</code>，而不是<code>import&lt;&gt;</code>，心想他们怎么能这么搞呢，可是又想到为什么在没有开启这个功能时，编译却是正常的呢？当时心中第一个想到的就是是否是因为hmap文件的原因呢？毕竟打开之后就已经跨工程了，hmap里肯定就失去映射了吧。于是复制报错库的任一文件的编译参数，置于终端中而加-v运行，从<code>#include &quot;...&quot; search starts here:</code>往下看，其只有两个hmap文件，打印其内容，果然不出所料，只有当前库工程内的头文件映射，而关闭这个功能后，再次一看，由于所有Pod为一个Target中，其内的xxx-project-headers.hmap中包含了所有Pod的头文件映射，所以才在以前没出现过问题。当然解决这个问题也很简单，一是看这个库是否有修复这个问题，二是自己对Cocoapods提供的post_install中对那个库设置<code>User Header Search Paths</code>或<code>Header Search Paths</code>，至此问题解决。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2019/10/03/网络学习笔记-TCP/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'true';
var disqus_identifier = '2020/08/23/iOS学习笔记-hmap文件/';
var disqus_title = 'iOS学习笔记-hmap文件';
var disqus_url = 'http://yoursite.com/2020/08/23/iOS学习笔记-hmap文件/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//true.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2020 <a href="http://yoursite.com">John Doe</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>